{% extends "base.html" %}

{% block title %}Bài tập - Học Trực Tuyến{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="title-gradient">Bài tập</h1>
        {% if role == 'teacher' %}
        <a href="{{ url_for('create_assignment', course_id=course_id) }}" class="btn btn-primary-custom">
            <i class="bi bi-plus-circle"></i> Tạo bài tập mới
        </a>
        {% endif %}
    </div>

    {% if assignments %}
    <div class="row g-4">
        {% for assignment in assignments %}
        <div class="col-md-6">
            <div class="card-soft">
                <h5 class="mb-3">{{ assignment.tieu_de }}</h5>
                <p class="text-muted mb-3">{{ assignment.mo_ta or 'Không có mô tả' }}</p>
                <p class="text-muted mb-3">
                    <small>
                        <i class="bi bi-calendar text-brand-sky"></i> Hạn nộp: 
                        <strong>{{ assignment.han_nop.strftime('%d/%m/%Y %H:%M') if assignment.han_nop else 'Không có hạn' }}</strong>
                    </small>
                </p>
                {% if role == 'student' %}
                    {% if assignment.id in submissions %}
                        {% set submission = submissions[assignment.id] %}
                        <div class="alert alert-info mb-3">
                            <strong>Đã nộp:</strong> {{ submission.created_at.strftime('%d/%m/%Y %H:%M') }}
                            {% if submission.diem_so %}
                            <br><strong>Điểm:</strong> {{ submission.diem_so }}/10
                            {% endif %}
                        </div>
                        <a href="{{ url_for('submit_assignment', assignment_id=assignment.id) }}" class="btn btn-outline-custom">
                            <i class="bi bi-pencil"></i> Xem/Nộp lại
                        </a>
                    {% else %}
                        <a href="{{ url_for('submit_assignment', assignment_id=assignment.id) }}" class="btn btn-primary-custom">
                            <i class="bi bi-send"></i> Nộp bài
                        </a>
                    {% endif %}
                {% else %}
                    <a href="{{ url_for('course_detail', course_id=course_id) }}" class="btn btn-outline-custom">
                        <i class="bi bi-eye"></i> Xem chi tiết
                    </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card-soft text-center py-5">
        <i class="bi bi-file-earmark-text text-muted" style="font-size: 4rem;"></i>
        <p class="text-muted mt-3">Chưa có bài tập nào.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
